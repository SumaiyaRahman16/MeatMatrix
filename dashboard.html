<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Management Dashboard</title>
    <link rel="stylesheet" href="css/dashboard.css">
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="dashboard">
        <div class="sidebar-icons">
            <div class="logo">
                <i class="fas fa-home icon"></i>
            </div>
            
            <div class="nav-icon active" id="dashboardToggle" style="cursor: pointer;">
                <i class="fas fa-home icon"></i>
            </div>
            
            <div class="nav-icon">
                <i class="fas fa-user icon"></i>
            </div>
            
            <div class="nav-icon">
                <i class="fas fa-trophy icon"></i>
            </div>
            
            <div class="nav-icon">
                <i class="fas fa-shopping-cart icon"></i>
            </div>
            
            <div class="nav-icon">
                <i class="fas fa-box icon"></i>
            </div>
            
            <div class="nav-icon">
                <i class="fas fa-chart-line icon"></i>
            </div>
            
            <div class="nav-icon">
                <i class="fas fa-comments icon"></i>
            </div>
            
            <div class="nav-icon">
                <i class="fas fa-cog icon"></i>
            </div>
            
            <div class="nav-icon">
                <i class="fas fa-star icon"></i>
            </div>
            
            <div class="nav-icon">
                <i class="fas fa-clock icon"></i>
            </div>
            
            <div class="nav-icon" style="margin-top: auto;">
                <i class="fas fa-sign-out-alt icon"></i>
            </div>
        </div>

        <div class="sidebar-extended" id="extendedSidebar">
            <div class="dashboard-btn">Dashboard</div>
            
            <div class="nav-item active">
                <i class="fas fa-home icon"></i>
                <span>Dashboard</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-user icon"></i>
                <span>Profile</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-trophy icon"></i>
                <span>Leaderboard</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-shopping-cart icon"></i>
                <span>Order</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-box icon"></i>
                <span>Product</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-chart-line icon"></i>
                <span>Sales Report</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-comments icon"></i>
                <span>Message</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-cog icon"></i>
                <span>Settings</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-star icon"></i>
                <span>Favourite</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-clock icon"></i>
                <span>History</span>
            </div>
            
            <div class="nav-item">
                <i class="fas fa-sign-out-alt icon"></i>
                <span>Signout</span>
            </div>
        </div>

        <!-- Main Content -->
        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <div class="search-container">
                    <i class="fas fa-search search-icon icon-sm"></i>
                    <input type="text" class="search-input" placeholder="Search here...">
                </div>
                
                <div class="header-right">
                    <div class="notification">
                        <i class="fas fa-bell icon"></i>
                    </div>
                    
                    <div class="user-profile">
                        <div class="avatar"></div>
                        <i class="fas fa-chevron-down icon-sm"></i>
                    </div>
                </div>
            </div>

            <div class="content-grid">
                <!-- Left Column -->
                <div>
                    <!-- Today's Sales -->
                    <div class="section-title">Today's Sales</div>
                    <div class="section-subtitle">Sales Summary</div>
                    
                    <div class="sales-cards">
                        <div class="sales-card" onclick="window.location.href='totalsale.html'" style="cursor: pointer;">
                            <div class="card-icon yellow">
                                <i class="fas fa-chart-line icon"></i>
                            </div>
                            <div class="card-value" id="totalSalesCard">à§³0</div>
                            <div class="card-label">Total Sales</div>
                            <div class="card-change positive" id="salesChangeCard">No data yet</div>
                        </div>
                        
                        <div class="sales-card" onclick="window.location.href='totalorder.html'" style="cursor: pointer;">
                            <div class="card-icon blue">
                                <i class="fas fa-chart-bar icon"></i>
                            </div>
                            <div class="card-value" id="totalOrderCard">0</div>
                            <div class="card-label">Total Order</div>
                            <div class="card-change positive" id="orderChangeCard">No data yet</div>
                        </div>
                        
                        <div class="sales-card">
                            <div class="card-icon teal">
                                <i class="fas fa-box icon"></i>
                            </div>
                            <div class="card-value">9</div>
                            <div class="card-label">Product Sold</div>
                            <div class="card-change positive">+2% from yesterday</div>
                        </div>
                        
                        <div class="sales-card">
                            <div class="card-icon blue">
                                <i class="fas fa-users icon"></i>
                            </div>
                            <div class="card-value">12</div>
                            <div class="card-label">New Customer</div>
                            <div class="card-change blue">+3% from yesterday</div>
                        </div>
                    </div>

                    <!-- Meat Inventory Dashboard -->
                    <div class="inventory-dashboard">
                        <h3 class="section-title">Meat Inventory Dashboard</h3>
                        
                        <div class="inventory-table">
                            <div class="table-header">
                                <div>#</div>
                                <div>Name</div>
                                <div>Quantity</div>
                                <div>Sales</div>
                            </div>
                            
                            <div class="table-row">
                                <div style="font-weight: 500;">01</div>
                                <div>Inventory Overview (Total Stock)</div>
                                <div>
                                    <div class="progress-bar">
                                        <div class="progress-fill orange" style="width: 46%;"></div>
                                    </div>
                                </div>
                                <div>
                                    <span class="sales-percentage">46%</span>
                                </div>
                            </div>
                            
                            <div class="table-row">
                                <div style="font-weight: 500;">02</div>
                                <div>Expiring Soon Items</div>
                                <div>
                                    <div class="progress-bar">
                                        <div class="progress-fill gray" style="width: 17%;"></div>
                                    </div>
                                </div>
                                <div>
                                    <span class="sales-percentage">17%</span>
                                </div>
                            </div>
                            
                            <div class="table-row">
                                <div style="font-weight: 500;">03</div>
                                <div>Low Stock Alerts</div>
                                <div>
                                    <div class="progress-bar">
                                        <div class="progress-fill blue" style="width: 19%;"></div>
                                    </div>
                                </div>
                                <div>
                                    <span class="sales-percentage">19%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Charts -->
                    <div class="bottom-grid">
                        <div class="chart-container" onclick="window.location.href='totalstock.html'" style="cursor: pointer;">
                            <h3 class="section-title">Total Stock</h3>
                            <div class="donut-chart">
                                <div style="position: relative; width: 240px; height: 240px; margin: 0 auto;">
                                    <svg id="stockDonutChart" width="240" height="240" viewBox="0 0 240 240" style="filter: drop-shadow(0 2px 8px rgba(0,0,0,0.12));">
                                        <defs>
                                            <linearGradient id="outerDonutGradient" x1="0" y1="0" x2="1" y2="1">
                                                <stop offset="0%" stop-color="#2563eb"/> <!-- blue -->
                                                <stop offset="50%" stop-color="#06b6d4"/> <!-- cyan -->
                                                <stop offset="100%" stop-color="#a78bfa"/> <!-- yash (purple) -->
                                            </linearGradient>
                                        </defs>
                                        <circle cx="120" cy="120" r="105" fill="none" stroke="url(#outerDonutGradient)" stroke-width="10"/>
                                        <circle cx="120" cy="120" r="90" fill="#f8e7ef" stroke="#e5e7eb" stroke-width="18"/>
                                    </svg>
                                    <div id="donutLabels" style="position: absolute; top: 0; left: 0; width: 240px; height: 240px; pointer-events: none;"></div>
                                </div>
                                <div class="donut-legend" style="display: flex; justify-content: center; gap: 24px; margin-top: 16px; font-size: 1.1em;">
                                    <span style="display: flex; flex-direction: column; align-items: center; min-width: 60px;">
                                        <span style="display: flex; align-items: center;">
                                            <span style="width: 16px; height: 16px; background: #2563eb; border-radius: 50%; display: inline-block; margin-right: 6px; border: 2px solid #fff;"></span>
                                            Beef
                                        </span>
                                        <span id="beefPercent" style="color: #2563eb; font-weight: bold; font-size: 1em; margin-top: 2px;"></span>
                                    </span>
                                    <span style="display: flex; flex-direction: column; align-items: center; min-width: 60px;">
                                        <span style="display: flex; align-items: center;">
                                            <span style="width: 16px; height: 16px; background: #06b6d4; border-radius: 50%; display: inline-block; margin-right: 6px; border: 2px solid #fff;"></span>
                                            Chicken
                                        </span>
                                        <span id="chickenPercent" style="color: #06b6d4; font-weight: bold; font-size: 1em; margin-top: 2px;"></span>
                                    </span>
                                    <span style="display: flex; flex-direction: column; align-items: center; min-width: 60px;">
                                        <span style="display: flex; align-items: center;">
                                            <span style="width: 16px; height: 16px; background: #a78bfa; border-radius: 50%; display: inline-block; margin-right: 6px; border: 2px solid #fff;"></span>
                                            Duck
                                        </span>
                                        <span id="duckPercent" style="color: #a78bfa; font-weight: bold; font-size: 1em; margin-top: 2px;"></span>
                                    </span>
                                    <span style="display: flex; flex-direction: column; align-items: center; min-width: 60px;">
                                        <span style="display: flex; align-items: center;">
                                            <span style="width: 16px; height: 16px; background: #334155; border-radius: 50%; display: inline-block; margin-right: 6px; border: 2px solid #fff;"></span>
                                            Mutton
                                        </span>
                                        <span id="muttonPercent" style="color: #334155; font-weight: bold; font-size: 1em; margin-top: 2px;"></span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="chart-container">
                            <h3 class="section-title">Inventory Categories</h3>
                            <div class="category-grid">
                                <div class="category-item">
                                    <div class="category-icon"><i class="fas fa-drumstick-bite"></i></div>
                                </div>
                                <div class="category-item">
                                    <div class="category-icon"><i class="fas fa-feather-alt"></i></div>
                                </div>
                                <div class="category-item">
                                    <div class="category-icon"><i class="fas fa-dog"></i></div>
                                </div>
                                <div class="category-item">
                                    <div class="category-icon"><i class="fas fa-cow"></i></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Sidebar -->
                <div class="right-sidebar">
                    <!-- Level Chart -->
                    <div class="level-chart">
                        <h3 class="section-title">Level</h3>
                        <div class="bar-chart">
                            <div class="bar" style="height: 60%;"></div>
                            <div class="bar" style="height: 80%;"></div>
                            <div class="bar" style="height: 70%;"></div>
                            <div class="bar" style="height: 50%;"></div>
                            <div class="bar" style="height: 90%;"></div>
                            <div class="bar" style="height: 100%;"></div>
                        </div>
                        <div class="chart-legend">
                            <div class="legend-item">
                                <div class="legend-dot teal"></div>
                                <span>Volume</span>
                            </div>
                            <span>Service</span>
                        </div>
                    </div>

                    <!-- Customer Fulfillment -->
                    <div class="fulfillment-chart">
                        <h3 class="section-title">Customer Fulfillment</h3>
                        <div class="line-chart">
                            <svg width="100%" height="128" viewBox="0 0 300 128">
                                <polyline fill="none" stroke="#a9dfd8" stroke-width="2" 
                                         points="0,100 50,80 100,90 150,70 200,60 250,50 300,40"/>
                                <polyline fill="none" stroke="#f2c8ed" stroke-width="2" 
                                         points="0,110 50,105 100,100 150,95 200,90 250,85 300,80"/>
                            </svg>
                        </div>okay 
                        <div class="chart-stats">
                            <div class="stat-row">
                                <div class="legend-item">
                                    <div class="legend-dot teal"></div>
                                    <span style="font-size: 14px;">Last Month</span>
                                </div>
                                <span style="font-size: 14px;">$4,087</span>
                            </div>
                            <div class="stat-row">
                                <div class="legend-item">
                                    <div class="legend-dot pink"></div>
                                    <span style="font-size: 14px;">This Month</span>
                                </div>
                                <span style="font-size: 14px;">$5,506</span>
                            </div>
                        </div>
                    </div>

                    <!-- New Visitors -->
                    <div class="new-visitors">
                        <div class="visitors-indicator">
                            <div class="legend-dot yellow"></div>
                            <span style="font-size: 14px;">New Visitors</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get elements
        const dashboardToggle = document.getElementById('dashboardToggle');
        const extendedSidebar = document.getElementById('extendedSidebar');

        // Function to toggle sidebar
        function toggleSidebar() {
            extendedSidebar.classList.toggle('show');
        }

        // Add click event listener to dashboard icon
        dashboardToggle.addEventListener('click', toggleSidebar);

        // Close sidebar when clicking outside
        document.addEventListener('click', function(event) {
            const isClickInsideSidebar = extendedSidebar.contains(event.target) || 
                                       dashboardToggle.contains(event.target);
            
            if (!isClickInsideSidebar && extendedSidebar.classList.contains('show')) {
                extendedSidebar.classList.remove('show');
            }
        });

        // --- Dynamic Donut Chart for Total Stock ---
        // Stock data from totalstock.html
        const stockData = [
            { name: 'Beef', value: 15, color: '#2563eb' },      // blue
            { name: 'Chicken', value: 8, color: '#06b6d4' },    // cyan
            { name: 'Duck', value: 5, color: '#a78bfa' },       // yash (purple)
            { name: 'Mutton', value: 19, color: '#334155' }     // slate (neutral)
        ];

        // --- Load Sales Data from Total Sales Page ---
        function loadSalesData() {
            const salesData = JSON.parse(localStorage.getItem("salesData")) || [];
            const totalSalesEl = document.getElementById("totalSalesCard");
            const salesChangeEl = document.getElementById("salesChangeCard");
            
            if (salesData.length === 0) {
                totalSalesEl.textContent = "à§³0";
                salesChangeEl.textContent = "No data yet";
                salesChangeEl.className = "card-change";
                return;
            }

            // Calculate total sales
            const totalAmount = salesData.reduce((sum, day) => sum + day.total, 0);
            
            // Format total sales for display
            if (totalAmount >= 1000) {
                totalSalesEl.textContent = `à§³${(totalAmount / 1000).toFixed(1)}k`;
            } else {
                totalSalesEl.textContent = `à§³${totalAmount.toLocaleString()}`;
            }

            // Calculate change from previous day
            if (salesData.length > 1) {
                const latestDay = salesData[salesData.length - 1];
                const previousDay = salesData[salesData.length - 2];
                const percentChange = previousDay.total === 0 
                    ? 100 
                    : (((latestDay.total - previousDay.total) / previousDay.total) * 100).toFixed(1);
                
                const changeClass = percentChange >= 0 ? 'card-change positive' : 'card-change negative';
                const changeSymbol = percentChange >= 0 ? '+' : '';
                salesChangeEl.textContent = `${changeSymbol}${percentChange}% from yesterday`;
                salesChangeEl.className = changeClass;
            } else {
                salesChangeEl.textContent = "First entry";
                salesChangeEl.className = "card-change";
            }
        }

        // Load sales data on page load
        loadSalesData();

        // --- Load Order Data from Total Orders Page ---
        function loadOrderData() {
            const orderData = JSON.parse(localStorage.getItem("orderData")) || [];
            const totalOrderEl = document.getElementById("totalOrderCard");
            const orderChangeEl = document.getElementById("orderChangeCard");
            
            // Get today's date in YYYY-MM-DD format
            function getTodayDate() {
                const today = new Date();
                return today.toISOString().split('T')[0];
            }

            // Calculate today's orders
            const today = getTodayDate();
            const todayOrders = orderData.filter(order => order.date === today).length;
            
            // Calculate yesterday's orders
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];
            const yesterdayOrders = orderData.filter(order => order.date === yesterdayStr).length;
            
            // Update total orders display
            totalOrderEl.textContent = todayOrders;
            
            // Calculate and display change
            if (yesterdayOrders > 0) {
                const percentChange = yesterdayOrders === 0 
                    ? 100 
                    : (((todayOrders - yesterdayOrders) / yesterdayOrders) * 100).toFixed(1);
                
                const changeClass = percentChange >= 0 ? 'card-change positive' : 'card-change negative';
                const changeSymbol = percentChange >= 0 ? '+' : '';
                orderChangeEl.textContent = `${changeSymbol}${percentChange}% from yesterday`;
                orderChangeEl.className = changeClass;
            } else {
                orderChangeEl.textContent = todayOrders > 0 ? "First orders today" : "No orders yet";
                orderChangeEl.className = "card-change";
            }
        }

        // Load order data on page load
        loadOrderData();

        const totalStock = stockData.reduce((sum, item) => sum + item.value, 0); // 47
        const radius = 90;
        const center = 120;
        const circumference = 2 * Math.PI * radius;
        let offset = 0;
        const svg = document.getElementById('stockDonutChart');
        const labelContainer = document.getElementById('donutLabels');
        // Remove previous segments if any
        while (svg.children.length > 1) svg.removeChild(svg.lastChild);
        labelContainer.innerHTML = '';
        stockData.forEach((item, idx) => {
            const percent = item.value / totalStock;
            const dash = percent * circumference;
            // Draw segment
            const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            circle.setAttribute('cx', center);
            circle.setAttribute('cy', center);
            circle.setAttribute('r', radius);
            circle.setAttribute('fill', 'none');
            circle.setAttribute('stroke', item.color);
            circle.setAttribute('stroke-width', '18');
            circle.setAttribute('stroke-dasharray', dash + ',' + (circumference - dash));
            circle.setAttribute('stroke-dashoffset', offset);
            circle.setAttribute('transform', `rotate(-90 ${center} ${center})`);
            circle.setAttribute('style', 'transition: stroke-dasharray 0.8s; filter: drop-shadow(0 1px 4px rgba(0,0,0,0.10));');
            svg.appendChild(circle);
            // Set percentage under legend name
            const percentText = Math.round(percent * 100) + '%';
            if (item.name === 'Beef') {
                document.getElementById('beefPercent').textContent = percentText;
            } else if (item.name === 'Chicken') {
                document.getElementById('chickenPercent').textContent = percentText;
            } else if (item.name === 'Duck') {
                document.getElementById('duckPercent').textContent = percentText;
            } else if (item.name === 'Mutton') {
                document.getElementById('muttonPercent').textContent = percentText;
            }
            offset -= dash;
        });
    </script>
</body>
</html>